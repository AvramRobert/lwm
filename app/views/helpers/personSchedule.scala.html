@(person: Resource, labwork: Resource)
@import java.net.URLDecoder
@import utils.semantic.Vocabulary.RDFS
@import utils.semantic._
@import Vocabulary.LWM
@import utils.Global._
@import com.hp.hpl.jena.query.QueryExecutionFactory


@{
    val query =
        s"""
         |select * where {
         | $person ${LWM.hasScheduleAssociation} ?scheduleAssociation .
         | ?scheduleAssociation ${LWM.hasAssignmentAssociation} ?assignmentAssociation .
         | ?assignmentAssociation ${LWM.hasLabWork} $labwork .
         | ?scheduleAssociation ${LWM.hasAssignmentDate} ?assignmentDate .
         | ?scheduleAssociation ${LWM.hasAssignmentDateTimetableEntry} ?entry .
         | ?entry ${LWM.hasRoom} ?room .
         | ?entry ${LWM.hasStartTime} ?startTime .
         | ?room ${LWM.hasRoomId} ?roomId .
         | ?entry ${LWM.hasSupervisor} ?supervisor .
         | ?supervisor ${RDFS.label} ?supervisorName .
         | ?assignmentAssociation ${LWM.hasOrderId} ?id .
         |} order by asc(?id)
       """.stripMargin

    val result = QueryExecutionFactory.sparqlService(queryHost, query).execSelect()
    var lines = Vector("<table class=\"table\"><tr><th>Datum</th><th>Raum</th><th>Mitarbeiter</th></tr>")
    while(result.hasNext){
        val solution = result.next()
        val date = solution.getLiteral("assignmentDate").getString
        val room = solution.getLiteral("roomId").getString
        val time = URLDecoder.decode(solution.getLiteral("startTime").getString, "UTF-8")
        val supervisor = URLDecoder.decode(solution.getLiteral("supervisorName").getString, "UTF-8")
        val row = s"<tr><td>$date, $time Uhr</td><td>$room</td><td>$supervisor</td></tr>"
        lines = lines :+ row
    }
    lines = lines :+ "</table>"
    Html(lines.mkString("\n"))
}